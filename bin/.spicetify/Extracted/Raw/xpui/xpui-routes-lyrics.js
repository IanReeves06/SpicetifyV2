(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[25],{85683:function(e,t,r){"use strict";r.r(t),r.d(t,{LyricsContainer:function(){return H},default:function(){return J}});var c=r(27378),s=r.n(c),n=r(79308),a=r(85466),l=r(14298),i=r(16515),o="lyrics-lyricsContainer-LyricsContainer",u="lyrics-lyricsContainer-Loading",d="lyrics-lyricsContainer-LyricsUnavailablePage",f="lyrics-lyricsContainer-UnsyncedLyricsPage",m="lyrics-lyricsContainer-LyricsUnsyncedMessage",b="lyrics-lyricsContainer-SyncedLyricsPage",y="lyrics-lyricsContainer-LyricsBackground",v="lyrics-lyricsContainer-Provider",p="lyrics-lyricsContainer-SyncedLyrics",g="lyrics-lyricsContainer-LyricsLine",E="lyrics-lyricsContainer-LyricsUnavailableMessage",O=r(65526),h=r.n(O),k=r(35181),N=r(90550);var D=r(80446),j=r(38655);function x(e,t){const[r,s]=(0,c.useState)(!1),[n,a]=(0,c.useState)(0),l=(0,c.useMemo)((()=>(0,D.J)({lyrics_format:t,track_uri:e})),[t,e]);return(0,c.useEffect)((()=>{s(!1),a(0)}),[l]),(0,c.useEffect)((()=>{if(!r&&n>140){(0,j.M)().send(l),s(!0)}}),[n,r,l]),a}var L=r(9807);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,c)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){h()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const P={start:0,end:1,text:""},_={"--line-count":3},M=s().memo((({lyrics:e=[],provider:t,trackUri:r})=>{const[n,a]=(0,c.useState)(0),l=x(r,"card");(e=>{const t=(0,c.useRef)();t.current=e,(0,c.useEffect)((()=>{const e=N.O.subscribe("position",(e=>{var r;null===(r=t.current)||void 0===r||r.call(t,e)}));return()=>{N.O.unsubscribe(e)}}),[t])})((e=>a(e)));const i=(0,c.useMemo)((()=>[P,P,...e].map(((e,t)=>S(S({},e),{},{lineNumber:t})))),[e]),o=i.findIndex((({start:e,end:t})=>n>=e&&n<t)),u=(0,c.useMemo)((()=>{const e=Math.max(o-1,0);return i.slice(e,e+3+2)}),[o,i]);return(0,c.useEffect)((()=>{l((e=>i.reduce(((e,{text:t,lineNumber:r})=>{const c=t.length>1?t.length:0;return e+=o===r?c:0}),e)))}),[i,o,l]),s().createElement("div",{className:b,style:_},s().createElement("div",{className:p},u.map((({text:e,lineNumber:t},r)=>{const c={"--animation-index":r};return s().createElement("p",{className:g,style:c,key:t,dir:"auto"},e)}))),t&&s().createElement(L.Dy,{as:"p",variant:L.Dy.mesto,className:v,dir:"auto"},k.ag.get("lyrics.providedBy",t)))}));var C=r(9957);const U=s().memo((({onObserve:e,text:t})=>{const{ref:r,inView:n}=(0,C.YD)({threshold:0});return(0,c.useEffect)((()=>{n&&e(t)}),[n,e,t]),s().createElement("p",{className:g,ref:r,dir:"auto","data-testid":"unsynced-lyric"},t)})),A=s().memo((({lyrics:e=[],provider:t,trackUri:r})=>{const n=x(r,"fullscreen"),a=(0,c.useCallback)((e=>{e.length>1&&n((t=>t+e.length))}),[n]);return s().createElement("div",{className:f},s().createElement(L.Dy.p,{variant:L.$e.ballad,className:m},k.ag.get("lyrics.unsynced")),s().createElement("div",null,e.map((({text:e},t)=>s().createElement(U,{key:r+t,onObserve:a,text:e})))),t&&s().createElement(L.Dy,{as:"p",variant:L.Dy.mesto,className:v,dir:"auto"},k.ag.get("lyrics.providedBy",t)))})),B=[k.ag.get("lyrics.noLyrics0"),k.ag.get("lyrics.noLyrics1"),k.ag.get("lyrics.noLyrics2"),k.ag.get("lyrics.noLyrics3")],T=s().memo((()=>{const e=B[Math.floor(Math.random()*B.length)];return s().createElement("div",{className:d},s().createElement("span",{className:E},e))}));var I=r(82907),V=r(67684),W=r(86268);const Y=s().createElement("div",{className:u},s().createElement(i.H,null)),H=()=>{var e,t,r,c,i,u;const d=(0,n.v9)(I.Ci),f=(null==d?void 0:d.uri)||"",m=(null==d||null===(e=d.album)||void 0===e||null===(t=e.images)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.url)||"",{status:b,data:v}=(0,a.W)(f,m),p=(0,W.Y)((null==v?void 0:v.colors.dark)||null),[g]=(0,n.v9)(I.e5);(0,a.W)((null==g?void 0:g.uri)||"",(null==g||null===(c=g.album)||void 0===c||null===(i=c.images)||void 0===i||null===(u=i[0])||void 0===u?void 0:u.url)||"");let E=Y;if(f)if(b===V.LyricsTrackStatus.UNAVAILABLE)E=s().createElement(T,null);else if(b===V.LyricsTrackStatus.LOADED&&v){const{lyrics:e,provider:t,isTimeSynced:r}=v;E=r?s().createElement(M,{trackUri:f,lyrics:e,provider:t}):s().createElement(A,{trackUri:f,lyrics:e,provider:t})}const O={"--lyrics-color-active":(null==v?void 0:v.colors.active)||l.ixZ,"--lyrics-color-inactive":(null==v?void 0:v.colors.bright)||l.Snx,"--lyrics-color-background":p};return s().createElement("div",{className:o,style:O},s().createElement("div",{className:y}),E)};var J=H}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map